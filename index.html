<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paris Explorer Avanc√© - La Ville Lumi√®re</title>
    
    <!-- Leaflet CSS pour la carte -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Polices Google -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles personnalis√©s -->
    <link rel="stylesheet" href="assets/css/main-advanced.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <link rel="stylesheet" href="assets/css/themes.css">
    
    <!-- Meta pour PWA -->
    <meta name="theme-color" content="#D4AF37">
    <meta name="description" content="Explorez tous les tr√©sors cach√©s de Paris avec notre application interactive avanc√©e">
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üóº</text></svg>">
</head>
<body class="theme-transition">
    <div class="app-container">
        <!-- Header parisien avanc√© -->
        <header class="header">
            <div class="header-content">
                <div class="header-top">
                    <div>
                        <h1 class="app-title">üóº Paris Explorer</h1>
                        <p class="app-subtitle">D√©couvrez la Ville Lumi√®re - Version Avanc√©e</p>
                    </div>
                    <div class="user-controls">
                        <select class="user-selector" id="userSelector">
                            <option value="">Choisir un explorateur...</option>
                        </select>
                        <button class="btn btn-primary" id="manageUsersBtn">üë• Profils</button>
                        <button class="btn btn-secondary" id="settingsBtn">‚öôÔ∏è Param√®tres</button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number" id="totalPlaces">147</span>
                        <span class="stat-label">Lieux Total</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="totalProgress" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="visitedPlaces">0</span>
                        <span class="stat-label">Explor√©s</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="visitedProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="completionRate">0%</span>
                        <span class="stat-label">Compl√©t√©</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="completionProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="currentStreak">0</span>
                        <span class="stat-label">S√©rie</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="streakProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="favoritesCount">0</span>
                        <span class="stat-label">‚≠ê Favoris</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="favoritesProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="achievementsCount">0</span>
                        <span class="stat-label">üèÜ Succ√®s</span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="achievementsProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Navigation avec onglets avanc√©s -->
        <nav class="nav-section">
            <div class="nav-tabs">
                <div class="nav-tab active" data-tab="list">üìã Exploration</div>
                <div class="nav-tab" data-tab="map">üó∫Ô∏è Carte</div>
                <div class="nav-tab" data-tab="favorites">‚≠ê Favoris</div>
                <div class="nav-tab" data-tab="collections">üìö Collections</div>
                <div class="nav-tab" data-tab="achievements">üèÜ Succ√®s</div>
                <div class="nav-tab" data-tab="stats">üìä Statistiques</div>
            </div>
            
            <!-- Contenu onglet Liste -->
            <div class="tab-content active" id="listTab">
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="üîç Rechercher un monument, restaurant, quartier, tag...">
                    <div class="search-filters">
                        <select class="filter-select" id="arrondissementFilter">
                            <option value="">Tous les arrondissements</option>
                        </select>
                        <select class="filter-select" id="categoryFilter">
                            <option value="">Toutes les cat√©gories</option>
                        </select>
                        <select class="filter-select" id="statusFilter">
                            <option value="">Tous les statuts</option>
                            <option value="visited">Visit√©s</option>
                            <option value="unvisited">Non visit√©s</option>
                            <option value="favorites">Favoris</option>
                            <option value="noted">Avec notes</option>
                        </select>
                        <select class="filter-select" id="tagsFilter">
                            <option value="">Tous les tags</option>
                        </select>
                    </div>
                </div>
                
                <div class="controls-row">
                    <button class="filter-toggle" id="hideCompletedBtn">üëÅÔ∏è Masquer les Explor√©s</button>
                    
                    <div class="view-options">
                        <button class="btn btn-sm" id="compactViewBtn">üì± Vue Compacte</button>
                        <button class="btn btn-sm" id="sortBtn">üîÑ Trier</button>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-secondary" id="expandAllBtn">üìÇ Tout Ouvrir</button>
                        <button class="btn btn-secondary" id="collapseAllBtn">üìÅ Tout Fermer</button>
                        <button class="btn btn-success" id="exportDataBtn">üì§ Exporter</button>
                        <button class="btn btn-info" id="importDataBtn">üì• Importer</button>
                        <button class="btn btn-danger" id="resetProgressBtn">üîÑ Reset</button>
                    </div>
                </div>
            </div>
            
            <!-- Contenu onglet Carte -->
            <div class="tab-content" id="mapTab">
                <div class="map-container" id="mapContainer">
                    <div class="map-controls">
                        <button class="map-control-btn" id="fullscreenBtn" title="Mode plein √©cran">üî≥</button>
                        <button class="map-control-btn" id="centerMapBtn" title="Centrer sur Paris">üéØ</button>
                        <button class="map-control-btn" id="toggleLayersBtn" title="Basculer les couches">üóÇÔ∏è</button>
                        <button class="map-control-btn" id="mapStyleBtn" title="Style de carte">üé®</button>
                    </div>
                    <!-- La carte Leaflet sera inject√©e ici -->
                </div>
            </div>
            
            <!-- Contenu onglet Favoris -->
            <div class="tab-content" id="favoritesTab">
                <div class="favorites-container">
                    <div class="favorites-grid" id="favoritesGrid">
                        <!-- Les favoris seront affich√©s ici -->
                    </div>
                </div>
            </div>
            
            <!-- Contenu onglet Collections -->
            <div class="tab-content" id="collectionsTab">
                <div class="collections-container">
                    <div class="collections-grid" id="collectionsGrid">
                        <!-- Les collections seront affich√©es ici -->
                    </div>
                </div>
            </div>
            
            <!-- Contenu onglet Succ√®s -->
            <div class="tab-content" id="achievementsTab">
                <div class="achievements-container">
                    <div class="achievements-grid" id="achievementsGrid">
                        <!-- Les achievements seront affich√©s ici -->
                    </div>
                </div>
            </div>
            
            <!-- Contenu onglet Statistiques -->
            <div class="tab-content" id="statsTab">
                <div class="stats-dashboard">
                    <div class="stats-section">
                        <h3>üìä Progression par Arrondissement</h3>
                        <div class="arrondissement-stats" id="arrondissementStats">
                            <!-- Les statistiques par arrondissement seront g√©n√©r√©es ici -->
                        </div>
                    </div>
                    
                    <div class="stats-section">
                        <h3>üìà √âvolution dans le Temps</h3>
                        <div class="timeline-stats" id="timelineStats">
                            <!-- Graphique de progression temporelle -->
                        </div>
                    </div>
                    
                    <div class="stats-section">
                        <h3>üèÜ Mes Achievements</h3>
                        <div class="achievements-summary" id="achievementsSummary">
                            <!-- R√©sum√© des achievements -->
                        </div>
                    </div>
                    
                    <div class="stats-section">
                        <h3>üìö Mes Collections</h3>
                        <div class="collections-summary" id="collectionsSummary">
                            <!-- R√©sum√© des collections -->
                        </div>
                    </div>
                    
                    <div class="stats-section">
                        <h3>üìù Activit√© R√©cente</h3>
                        <div class="activity-feed" id="activityFeed">
                            <!-- Feed d'activit√© -->
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Contenu principal -->
        <main class="main-content" id="mainContent">
            <div class="loading-message" id="loadingMessage">
                <div class="loading-content">
                    <div class="spinner"></div>
                    <h3>üóº Chargement de Paris...</h3>
                    <p>Pr√©paration de votre exploration parisienne avanc√©e</p>
                </div>
            </div>
            
            <div class="error-message" id="errorMessage" style="display: none;">
                <div class="error-content">
                    <h3>üö´ Fichier de donn√©es manquant</h3>
                    <p><strong>L'application a besoin du fichier <code>paris-database.json</code></strong></p>
                    <p>Ce fichier contient la base de donn√©es compl√®te des lieux parisiens.</p>
                    <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 14px; text-align: left;">
                        <strong>Pour utiliser cette application :</strong><br>
                        1. V√©rifiez que le fichier <code>paris-database.json</code> existe<br>
                        2. Servez l'application via un serveur web local<br>
                        3. Exemple : <code>python -m http.server 8000</code><br>
                        4. Ouvrez : <code>http://localhost:8000</code>
                    </div>
                </div>
            </div>
            
            <!-- Contenu dynamique des arrondissements -->
            <div class="arrondissements-container" id="arrondissementsContainer" style="display: none;">
                <!-- Les arrondissements seront g√©n√©r√©s dynamiquement ici -->
            </div>
        </main>
    </div>
    
    <!-- Modal gestion des utilisateurs avanc√© -->
    <div class="modal" id="userModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 class="modal-title">üë• Gestion des Explorateurs</h3>
                <button class="close-btn" id="closeModalBtn">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="user-management-tabs">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="create">Cr√©er</button>
                        <button class="tab-btn" data-tab="manage">G√©rer</button>
                        <button class="tab-btn" data-tab="import">Import/Export</button>
                    </div>
                    
                    <!-- Onglet Cr√©ation -->
                    <div class="tab-panel active" id="createTab">
                        <div class="form-group">
                            <label class="form-label">Cr√©er un Nouvel Explorateur</label>
                            <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                                <input type="text" class="form-input" id="newUserName" placeholder="Nom de l'explorateur...">
                                <button class="btn btn-success" id="createUserBtn">Cr√©er</button>
                            </div>
                            
                            <div class="user-options">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="defaultSettingsCheck">
                                    <span>Utiliser mes param√®tres par d√©faut</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="copyProgressCheck">
                                    <span>Copier ma progression actuelle</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Onglet Gestion -->
                    <div class="tab-panel" id="manageTab">
                        <div class="form-group">
                            <label class="form-label">Explorateurs Existants</label>
                            <div class="user-list" id="userList">
                                <!-- Les utilisateurs seront list√©s ici -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Onglet Import/Export -->
                    <div class="tab-panel" id="importExportTab">
                        <div class="import-export-options">
                            <div class="export-section">
                                <h4>üì§ Exporter</h4>
                                <div class="export-options">
                                    <button class="btn btn-secondary" onclick="app.uiManager.exportUserData('progress')">Progression</button>
                                    <button class="btn btn-secondary" onclick="app.uiManager.exportUserData('favorites')">Favoris</button>
                                    <button class="btn btn-secondary" onclick="app.uiManager.exportUserData('notes')">Notes</button>
                                    <button class="btn btn-secondary" onclick="app.uiManager.exportUserData('collections')">Collections</button>
                                    <button class="btn btn-primary" onclick="app.uiManager.exportUserData('complete')">Tout</button>
                                </div>
                            </div>
                            
                            <div class="import-section">
                                <h4>üì• Importer</h4>
                                <div class="import-area">
                                    <button class="btn btn-primary" onclick="document.getElementById('importFileInput').click()">
                                        S√©lectionner fichier JSON
                                    </button>
                                    <p class="import-info">
                                        Formats support√©s : progression, favoris, notes, collections ou donn√©es compl√®tes
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Param√®tres -->
    <div class="modal" id="settingsModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 class="modal-title">‚öôÔ∏è Param√®tres Avanc√©s</h3>
                <button class="close-btn" id="closeSettingsModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="settingsContainer">
                    <!-- Les param√®tres seront rendus ici -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Collection -->
    <div class="modal" id="collectionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="collectionModalTitle">üìö Nouvelle Collection</h3>
                <button class="close-btn" id="closeCollectionModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nom de la collection</label>
                    <input type="text" class="form-input" id="collectionName" placeholder="Ex: Mes restaurants pr√©f√©r√©s">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-input" id="collectionDescription" placeholder="D√©crivez votre collection..." rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Couleur</label>
                    <div class="color-picker">
                        <input type="color" id="collectionColor" value="#3b82f6">
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="app.uiManager.closeCollectionModal()">Annuler</button>
                    <button class="btn btn-primary" id="saveCollectionBtn">Cr√©er</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Ajout √† Collection -->
    <div class="modal" id="addToCollectionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üìö Ajouter √† une Collection</h3>
                <button class="close-btn" id="closeAddToCollectionModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="collections-list" id="collectionsListForAdd">
                    <!-- Liste des collections -->
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="app.uiManager.closeAddToCollectionModal()">Annuler</button>
                    <button class="btn btn-primary" onclick="app.uiManager.openCreateCollectionModal()">Nouvelle Collection</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Details Lieu -->
    <div class="modal" id="placeModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 class="modal-title" id="placeModalTitle"></h3>
                <button class="close-btn" id="closePlaceModalBtn">&times;</button>
            </div>
            <div class="modal-body" id="placeModalContent">
                <!-- Contenu d√©taill√© du lieu -->
            </div>
        </div>
    </div>
    
    <!-- Toast Notifications Container -->
    <div class="notifications-container" id="notificationsContainer">
        <!-- Les notifications dynamiques appara√Ætront ici -->
    </div>
    
    <!-- Inputs cach√©s -->
    <input type="file" id="importFileInput" accept=".json" style="display: none;">
    
    <!-- Loading Spinner Global -->
    <div class="global-loading" id="globalLoading" style="display: none;">
        <div class="loading-spinner"></div>
        <p>Chargement...</p>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Modules JavaScript avanc√©s -->
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/data-manager.js"></script>
    <script src="assets/js/user-manager-advanced.js"></script>
    <script src="assets/js/map-manager.js"></script>
    <script src="assets/js/ui-manager-advanced.js"></script>
    <script src="assets/js/search-filter.js"></script>
    <script src="assets/js/export-import-advanced.js"></script>
    <script src="assets/js/app-advanced.js"></script>
    
    <!-- Service Worker pour PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(registrationError => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>
